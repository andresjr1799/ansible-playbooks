---
- name: Sincronizar Sofia + DB
  hosts: sofia
  become: yes
  gather_facts: no

  vars:
    path_erp_origen: "/mnt/colmedicos/webserver/colmedicos/domains/{{ instancia_origen }}.colmedicos.com/public_html"
    path_erp_destino: "/mnt/colmedicos/webserver/colmedicos/domains/{{ instancia_destino }}.colmedicos.com/public_html"
    path_bd_origen: "/mnt/colmedicos/mysqlserver/{{ instancia_origen }}"
    path_bd_destino: "/mnt/colmedicos/mysqlserver/{{ instancia_destino }}"
        
  tasks:
    - name: Transferir ERP
      shell: |
         rsync -avh --exclude='erp/pco/SOFIA' {{ path_erp_origen }}/erp {{ path_erp_destino }}
    
    - name: Transferir index.snt
      shell: |
         rsync -avh --exclude='erp/pco/SOFIA' {{ path_erp_origen }}/index.snt {{ path_erp_destino }}          

    - name: Transferir base de datos
      shell: |
         rsync -avh {{ path_bd_origen }}/ {{ path_bd_destino }}

    - name: Permisos para ERP
      ansible.builtin.file:
        path: "{{ path_erp_destino }}/erp"
        mode: '0777'
        recurse: yes
        owner: root
        group: root
        follow: no
   
    - name: Permisos para MYSQL
      ansible.builtin.file:
        path: "{{ path_bd_destino }}"
        mode: '0777'
        recurse: yes
        owner: mysql
        group: mysql
        follow: no

    - name: Crear enlace simb√≥lico SOFIA
      ansible.builtin.file:
        src: ".."
        dest: "{{ path_erp_destino }}/erp/pco/SOFIA"
        state: link
  

       

        
